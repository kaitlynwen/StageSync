<!DOCTYPE html>
<html lang="en">

<head>
  <!--Dark mode toggle-->
  <script>
    (function () {
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const html = document.documentElement;

      if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
        html.classList.add('dark');
      } else {
        html.classList.remove('dark');
      }
    })();
  </script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="csrf-token" content="{{ csrf_token() }}">

  <!-- Boxicons -->
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />

  <!-- FullCalendar Styles and Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.15/index.global.js"
    integrity="sha512-3I+0zIxy2IkeeCvvhXUEu+AFT3zAGuHslHLDmM8JBv6FT7IW6WjhGpUZ55DyGXArYHD0NshixtmNUWJzt0K32w=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <!-- Flowbite -->
  <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/tailwind.css') }}" />
  <link rel="icon" href="{{ url_for('static', filename='img/Logo.png') }}" />

  <!-- Set Title of Page -->
  <title>User Access Control - StageSync</title>
</head>

<body class="flex flex-col min-h-screen font-sans bg-white dark:bg-neutral-900">
  <main class="flex flex-grow bg-white dark:bg-neutral-900">
    <!-- Sidebar Section -->
    {% if user.is_admin %}
    {% include 'sidebar-admin.html' %}
    {% else %}
    {% include 'sidebar.html' %}
    {% endif %}

    <!-- Main Content Section -->
    <div class="flex-1 flex flex-col pt-18 pb-8 sm:pt-6 px-6 sm:px-10 ">
      <div class="flex justify-between items-center mt-2">
        <div>
          <p class="text-3xl font-bold dark:text-neutral-200">User Access Control</p>
          <p class="text-md text-neutral-500 pt-4 dark:text-neutral-400">
            Manage user access and authorization to the application
          </p>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div id="alert-container" class="flex flex-col space-y-2 mb-4">
          {% for category, message in messages %}
          <div class="alert w-full px-4 py-3 rounded-md relative transition-all duration-300 opacity-100
            {% if category == 'success' %}
              bg-green-100 border border-green-400 text-green-700
            {% elif category == 'error' %}
              bg-red-100 border border-red-400 text-red-700
            {% elif category == 'warning' %}
              bg-yellow-100 border border-yellow-400 text-yellow-700
            {% elif category == 'info' %}
              bg-blue-100 border border-blue-400 text-blue-700
            {% endif %}
          " role="alert">
            <div class="flex justify-between items-center">
              <strong class="font-bold flex items-center">
                {% if category == 'success' %}
                <i class="bx bxs-check-circle bx-sm mr-2"></i> Success!
                {% elif category == 'error' %}
                <i class="bx bxs-error bx-sm mr-2"></i> Error!
                {% elif category == 'warning' %}
                <i class="bx bxs-error-circle bx-sm mr-2"></i> Warning!
                {% elif category == 'info' %}
                <i class="bx bxs-info-circle bx-sm mr-2"></i> Info!
                {% endif %}
              </strong>

              <button onclick="this.parentElement.parentElement.remove()" class="flex items-center focus:outline-none
          {% if category == 'success' %}text-green-700 hover:text-green-900
          {% elif category == 'error' %}text-red-700 hover:text-red-900
          {% elif category == 'warning' %}text-yellow-700 hover:text-yellow-900
          {% elif category == 'info' %}text-blue-700 hover:text-blue-900
          {% endif %}">
                <i class="bx bx-x bx-sm"></i>
              </button>
            </div>
            <span class="block sm:inline mt-1">{{ message }}</span>
          </div>
          {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
      </div>

      <hr class="h-px my-6 bg-neutral-200 border-0 dark:bg-neutral-700">

      <div class="flex justify-between items-center">
        <div>
          <p class="text-xl font-bold dark:text-neutral-200">Remove Members</p>
          <p class="text-md text-neutral-500 py-4 dark:text-neutral-400">
            To remove a user, check the box next to their name in the table below, then click the "Remove" button at the
            bottom.
          </p>
        </div>
      </div>

      <div class="flex max-h-2/5 overflow-y-auto w-full mt-4">
        <table class="table-auto w-full text-sm text-left rtl:text-right text-neutral-500 dark:text-neutral-400">
          <thead
            class="text-xs text-neutral-700 uppercase bg-neutral-50 dark:bg-neutral-700 dark:text-neutral-400 sticky top-0 z-10">
            <tr>
              <th scope="col" class="px-6 py-3"></th>
              <th scope="col" class="px-6 py-3">netid</th>
              <th scope="col" class="px-6 py-3">First Name</th>
              <th scope="col" class="px-6 py-3">Last Name</th>
            </tr>
          </thead>
          <tbody>
            {% for member in old_members %}
            <tr class="bg-white border-b dark:bg-neutral-800 dark:border-neutral-700 border-neutral-200">
              <td class="px-6 py-4">
                <input type="checkbox"
                  class="member-checkbox text-indigo-500 bg-neutral-100 border-neutral-300 rounded-sm focus:ring-indigo-500 dark:focus:ring-indigo-600 dark:ring-offset-neutral-800 focus:ring-2 dark:bg-neutral-700 dark:border-neutral-600 rounded-xs"
                  value="{{ member.netid }}" />
              </td>
              <td class="px-6 py-4">{{ member.netid }}</td>
              <td class="px-6 py-4">{{ member.first_name }}</td>
              <td class="px-6 py-4">{{ member.last_name }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>


      <div class="flex justify-between mt-6">
        <button id="unauthorize-button"
          class="text-white font-sm border-2 bg-indigo-500 border-indigo-500 hover:bg-indigo-700 hover:border-indigo-700 py-2 px-4 rounded-md">
          Unauthorize Selected Members
        </button>
      </div>

      <hr class="h-px my-6 bg-neutral-200 border-0 dark:bg-neutral-700">

      <div class="flex justify-between items-center">
        <div>
          <p class="text-xl font-bold dark:text-neutral-200">Add Members</p>
          <p class="text-md text-neutral-500 py-4 dark:text-neutral-400">
            Enter the NetID of the user you want to authorize, then click the "Authorize" button.
          </p>
        </div>
      </div>

      <div class="flex justify-between mt-6">
        <form id="authorize-form">
          <label for="netid" class="font-sm mr-2 dark:text-neutral-200">NetID to Authorize:</label>
          <input type="text" id="netid" name="netid" class="px-4 py-2 font-sm border rounded-md"
            placeholder="Enter NetID" required />
          <button type="submit"
            class="text-white bg-indigo-500 border-2 border-indigo-500 hover:bg-indigo-700 hover:border-indigo-700 py-2 px-4 rounded-md ml-2">
            Authorize
          </button>
        </form>
      </div>

    </div>
  </main>

  <script src="{{ url_for('static', filename='js/user-access.js') }}"></script>
  <script src="{{ url_for('static', filename='js/flash-alerts.js') }}"></script>
</body>

</html>